!function(){var __hasProp={}.hasOwnProperty,__extends=function(t,e){function o(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};!function t(e,o,r){function n(s,c){if(!o[s]){if(!e[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){var o=e[s][1][t];return n(o?o:t)},u,u.exports,t,e,o,r)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e){var o,r;r=t("./EventManager"),o=function(t){function e(t){this.controllers={},this.eventMgr=new r,e.__super__.constructor.call(this,t)}return __extends(e,t),e.inject("injector"),e.inject("controllerFactory","miwo.controllerFactory"),e.prototype.eventMgr=null,e.prototype.componentMgr=null,e.prototype.viewport=null,e.prototype.rendered=!1,e.prototype.controllers=null,e.prototype.runControllers=null,e.prototype.autoCanonicalize=!0,e.prototype.setInjector=function(t){if(this.injector=t,!t.has("viewport"))throw new Error("Missing 'viewport' service. Viewport is required to render your application")},e.prototype.run=function(t){var e,o,r,n;for(null==t&&(t=null),n=this.runControllers,o=0,r=n.length;r>o;o++)e=n[o],this.getController(e).startup();t&&this.render(t)},e.prototype.render=function(t){var e,o,r,n,i;if(null==t&&(t=null),!this.rendered){this.rendered=!0,r=this.getViewport(),n=this.controllers;for(o in n)e=n[o],e.beforeRender();r.render(t||miwo.body),i=this.controllers;for(o in i)e=i[o],e.afterRender();window.onhashchange=this.executeRequestByHash.bind(this),this.executeRequestByHash()}},e.prototype.getController=function(t){return this.controllers[t]||(this.controllers[t]=this.controllerFactory.create(t),this.controllers[t].application=this),this.controllers[t]},e.prototype.control=function(t,e){Type.isString(t)?this.eventMgr.control(t,e):t.on(e)},e.prototype.getViewport=function(){return this.injector.get("viewport")},e.prototype.getRouter=function(){return this.injector.get("miwo.router")},e.prototype.execute=function(t){this.getController(t.controller).execute(t)},e.prototype.forward=function(t){setTimeout(function(e){return function(){return e.execute(t)}}(this),1)},e.prototype.redirect=function(t){document.location.hash=this.getRouter().constructHash(t)},e.prototype.executeRequestByHash=function(){var t,e,o;return e=document.location.hash.substr(1).toLowerCase(),e||this.autoCanonicalize?(o=this.getRouter().constructRequest(e),t=this.getRouter().constructHash(o),this.autoCanonicalize&&t!==e?void(document.location.hash=t):void this.execute(o)):void 0},e}(Miwo.Object),e.exports=o},{"./EventManager":6}],2:[function(t,e){var o;o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.componentCls="miwo-views",e.prototype.role="main",e.prototype.addedComponent=function(t){e.__super__.addedComponent.call(this,t),t.el.addClass("miwo-views-item")},e.prototype.doRender=function(){e.__super__.doRender.apply(this,arguments),this.el.setStyle("overflow","auto")},e}(Miwo.Container),e.exports=o},{}],3:[function(t,e){var o,r=[].slice;o=function(t){function e(t){e.__super__.constructor.call(this,t),this.views={}}return __extends(e,t),e.prototype.name=null,e.prototype.injector=null,e.prototype.application=null,e.prototype.request=null,e.prototype.views=null,e.prototype.view=null,e.prototype.request=null,e.prototype.lastRequest=null,e.service=function(t,e){null==e&&(e=null),Object.defineProperty(this.prototype,t,{get:function(){return this.injector.get(e||t)}})},e.registerView=function(t,e){this.prototype["create"+t.capitalize()+"View"]=function(t){return new e(t)}},e.prototype.startup=function(){},e.prototype.beforeRender=function(){},e.prototype.afterRender=function(){},e.prototype.control=function(t,e){this.application.control(t,this.boundEvents(e))},e.prototype.getViewport=function(){return this.application.getViewport()},e.prototype.setInjector=function(t){this.injector=t},e.prototype.boundEvents=function(t){var e,o;for(o in t)e=t[o],t[o]=this.boundEvent(e);return t},e.prototype.boundEvent=function(t){return function(e){return function(){var o;return o=1<=arguments.length?r.call(arguments,0):[],Type.isString(t)?e[t].apply(e,o):t.apply(e,o)}}(this)},e.prototype.forward=function(t,e){this.request.executed=!0,this.application.forward(this.createRequest(t,e))},e.prototype.redirect=function(t,e){this.request.executed=!0,this.application.redirect(this.createRequest(t,e))},e.prototype.createRequest=function(t,e){return this.injector.get("miwo.requestFactory").create(t,e,{name:this.name,action:this.action})},e.prototype.execute=function(t){var e,o;this.request=t,this.view=t.action,e=this.formatMethodName(t.action,"action"),this[e]&&this[e](t.params),t.executed||(o=this.formatMethodName(this.view,"render"),this.view=this.getView(this.view),this.view.activateView(),this[o]&&this[o](t.params),t.executed=!0,this.lastRequest=t)},e.prototype.getView=function(t){var e,o;return t?(o=this.getViewport(),e=this.formatViewName(this.view),o.hasView(e)||o.addView(e,this.createView(this.view)),o.getView(e)):this.view},e.prototype.setView=function(t){this.view=t},e.prototype.createView=function(t){var e,o,r;if(r=this.getViewport(),e="create"+t.capitalize()+"View",!this[e])throw new Error("View "+t+" has no factory method. You must define "+e+" method in controller "+this);if(o=this[e]({isView:!0,viewName:this.formatViewName(t),id:this.name+t.capitalize()+"View"}),!(o instanceof Miwo.Component))throw new Error("Created view should by instance of Miwo.Component");return o.activateView=function(){r.activateView(this.viewName)},o},e.prototype.formatMethodName=function(t,e){return e+t.capitalize()},e.prototype.formatViewName=function(t){return this.name+"."+t},e}(Miwo.Object),e.exports=o},{}],4:[function(require,module,exports){var Controller,ControllerFactory;Controller=require("./Controller"),ControllerFactory=function(_super){function ControllerFactory(t){ControllerFactory.__super__.constructor.call(this,t),this.controllers={}}return __extends(ControllerFactory,_super),ControllerFactory.prototype.injector=ControllerFactory.inject("injector"),ControllerFactory.prototype.namespace="App",ControllerFactory.prototype.controllers=null,ControllerFactory.prototype.register=function(t,e){return this.controllers[t]=e,this},ControllerFactory.prototype.create=function(name){var controller,e,klass,klassName;klassName=this.formatClassName(name);try{klass=eval(klassName)}catch(_error){throw e=_error,new Error("Controller class "+klassName+" is bad defined")}if("function"!=typeof klass)throw new Error("Controller class "+klassName+" is not constructor");if(controller=this.injector.createInstance(klass),controller.setInjector(this.injector),controller.name=name,!(controller instanceof Controller))throw new Error("Controller "+klassName+" is not instance of Controller");return controller},ControllerFactory.prototype.formatClassName=function(t){return this.controllers[t]?this.controllers[t]:this.namespace+".controllers."+t.capitalize()+"Controller"},ControllerFactory}(Miwo.Object),module.exports=ControllerFactory},{"./Controller":3}],5:[function(t,e){var o,r,n,i,s,c;o=t("./Application"),c=t("./Router"),s=t("./RequestFactory"),n=t("./FlashNotificator"),r=t("./ControllerFactory"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.init=function(){this.setConfig({flash:null,controllers:{},run:[],defaultController:"default",defaultAction:"default",autoCanonicalize:!0})},e.prototype.build=function(t){t.define("application",o,function(t){return function(e){return e.runControllers=t.config.run,e.autoCanonicalize=t.config.autoCanonicalize}}(this)),t.define("flash",n,function(t){return function(e){return e.renderer=t.config.flash}}(this)),t.define("miwo.controllerFactory",r,function(t){return function(e){var o,r,n;e.namespace=t.config.namespace,n=t.config.controllers;for(r in n)o=n[r],e.register(r,o)}}(this)),t.define("miwo.router",c,function(t){return function(e){e.controller=t.config.defaultController,e.action=t.config.defaultAction}}(this)),t.define("miwo.requestFactory",s)},e}(Miwo.di.InjectorExtension),e.exports=i},{"./Application":1,"./ControllerFactory":4,"./FlashNotificator":7,"./RequestFactory":9,"./Router":10}],6:[function(t,e){var o;o=function(t){function e(){e.__super__.constructor.call(this),this.selectors=[],miwo.componentMgr.on("register",this.bound("onRegister")),miwo.componentMgr.on("unregister",this.bound("onUnregister"))}return __extends(e,t),e.prototype.selectors=null,e.prototype.control=function(t,e){this.selectors.push({selector:t,events:e})},e.prototype.onRegister=function(t){var e,o,r,n,i,s,c;for(s=this.selectors,n=0,i=s.length;i>n;n++)if(o=s[n],t.is(o.selector)){c=o.events;for(r in c)e=c[r],t.on(r,e)}},e.prototype.onUnregister=function(t){var e,o,r,n,i,s,c;for(s=this.selectors,n=0,i=s.length;i>n;n++)if(o=s[n],t.is(o.selector)){c=o.events;for(r in c)e=c[r],t.un(r,e)}},e.prototype.doDestroy=function(){miwo.componentMgr.un("register",this.bound("onRegister")),miwo.componentMgr.un("unregister",this.bound("onUnregister"))},e}(Miwo.Object),e.exports=o},{}],7:[function(t,e){var o;o=function(){function t(){this.renderer=function(t,e){console&&console.log("FLASH:",t,e)}}return t.prototype.renderer=null,t.prototype.error=function(t){this.message(t,"error")},t.prototype.info=function(t){this.message(t,"info")},t.prototype.warning=function(t){this.message(t,"warning")},t.prototype.message=function(t,e){this.renderer&&this.renderer(t,e)},t}(),e.exports=o},{}],8:[function(t,e){var o;o=function(){function t(t,e,o){this.controller=t,this.action=e,null==o&&(o={}),this.params=Object.merge({},o)}return t.prototype.isRequest=!0,t.prototype.controller=null,t.prototype.action=null,t.prototype.params=null,t}(),e.exports=o},{}],9:[function(t,e){var o,r;o=t("./Request"),r=function(){function t(){}return t.prototype.codeRe=/(([a-zA-Z]+)\:)?([a-z][a-zA-Z]+)/,t.prototype.create=function(t,e,r){var n,i,s;if(s=t.match(this.codeRe),!s)throw new Error("Bad redirect CODE");return i=void 0!==s[2]?s[2]:r.name,n="this"!==s[3]?r.action:s[3],new o(i,n,e)},t}(),e.exports=r},{"./Request":8}],10:[function(t,e){var o,r;o=t("./Request"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.controller="default",e.prototype.action="default",e.prototype.constructRequest=function(t){var e,r,n,i;return n=t.match(/^(([a-zA-Z]*)(\:([a-z][a-zA-Z]+))?(\?(.*))?)?$/),r=n[2]||this.controller,e=n[4]||this.action,i=n[6]?n[6].parseQueryString():{},new o(r,e,i)},e.prototype.constructHash=function(t){var e,o;return e=t.controller,(t.action&&t.action!==this.action||t.params&&Object.getLength(t.params)>0)&&(e+=":"+t.action,t.params&&(o=Object.toQueryString(t.params),o&&(e+="?"+o))),e},e}(Miwo.Object),e.exports=r},{"./Request":8}],11:[function(t,e){var o,r;o=t("./ContentContainer"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.id="viewport",e.prototype.name="viewport",e.prototype.layout="absolute",e.prototype.componentCls="miwo-viewport",e.prototype.contentEl="div",e.prototype.view=null,e.prototype.afterInit=function(){if(e.__super__.afterInit.apply(this,arguments),this.content=this.get("content",!1),!this.content)throw new Error("Content component missing");if(!(this.content instanceof o))throw new Error("Content component should by instance of ContentContainer")},e.prototype.addContent=function(t){return this.add("content",new o(t))},e.prototype.hasView=function(t){return!!this.content.get(this.formatName(t),!1)},e.prototype.getView=function(t){return this.content.get(this.formatName(t))},e.prototype.addView=function(t,e){return this.content.add(this.formatName(t),e)},e.prototype.activateView=function(t){return this.view&&(this.view.hide(),this.view.setActive(!1)),this.view=this.getView(t),this.view.show(),this.view.setActive(!0),this.view},e.prototype.formatName=function(t){var e,o,r;return r=t.split("."),e=r[0],o=r[1],e+o.capitalize()},e}(Miwo.Container),e.exports=r},{"./ContentContainer":2}],12:[function(t){Miwo.app={Application:t("./Application"),Controller:t("./Controller"),Router:t("./Router"),Request:t("./Request"),RequestFactory:t("./RequestFactory"),FlashNotificator:t("./FlashNotificator"),EventManager:t("./EventManager"),Viewport:t("./Viewport"),ContentContainer:t("./ContentContainer")},miwo.registerExtension("miwo-app",t("./DiExtension"))},{"./Application":1,"./ContentContainer":2,"./Controller":3,"./DiExtension":5,"./EventManager":6,"./FlashNotificator":7,"./Request":8,"./RequestFactory":9,"./Router":10,"./Viewport":11}]},{},[12])}();